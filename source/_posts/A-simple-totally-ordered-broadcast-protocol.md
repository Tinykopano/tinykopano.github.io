---
title: A simple totally ordered broadcast protocol
date: 2023-02-01 14:22:00 +0800
categories: [Course,Paper]
tags: [distributed system,consensus algorithm,Zab]
---

# 一种简单的完全有序的广播协议

## 摘要

这是一个关于ZooKeeper使用的完全有序的广播协议的简短概述，称为Zab。它在概念上很容易理解，容易实现，而且性能高。在本文中，我们介绍了ZooKeeper对Zab的要求，展示了该协议的使用方法，并概述了该协议的工作方式。

<!-- more -->

## 一、  引言

在雅虎，我们开发了一个高性能的高可用协调服务，称为ZooKeeper[9]，允许大规模的应用程序执行协调任务，如领导者选举、状态传播和会合。这个服务实现了一个数据节点的分层空间，称为znodes，客户使用它来实现他们的协调任务。我们发现这项服务很灵活，其性能很容易满足我们在雅虎的网络规模、关键任务应用程序的生产需求。ZooKeeper放弃了锁，而是实现了无等待的共享数据对象，对这些对象的操作顺序有很强的保证。客户端库利用这些保证来实现他们的协调任务。一般来说，ZooKeeper的主要前提之一是更新顺序对应用程序来说比其他典型的协调技术（如阻塞）更重要。

嵌入ZooKeeper的是一个完全有序的广播协议： Zab。在实现我们的客户端保证时，有序的广播是至关重要的；在每个ZooKeeper服务器上维护ZooKeeper状态的副本也是必要的。这些副本使用我们的完全有序的广播协议保持一致，如复制的状态机[13]。本文主要介绍ZooKeeper对这个广播协议的要求以及对其实现的概述。

一个ZooKeeper服务通常由三到七台机器组成。我们的实现支持更多的机器，但三到七台机器提供了足够的性能和恢复力。客户端连接到任何一台提供服务的机器上，并始终对ZooKeeper的状态有一个一致的看法。该服务最多可以容忍f个崩溃故障，它至少需要2f+1个服务器。

应用程序广泛地使用ZooKeeper，并且有几十到几千个客户端同时访问它，所以我们需要高吞吐量。我们将ZooKeeper设计为读写操作比例高于2:1的工作负载；但是，我们发现ZooKeeper的高写吞吐量也允许它用于一些写为主的工作负载。ZooKeeper通过为每个服务器上的ZooKeeper状态的本地副本的读取提供服务来提供高的读取吞吐量。因此，容错性和读取吞吐量都可以通过增加服务器来扩展服务。写入吞吐量不会因为增加服务器而扩大；相反，它受限于广播协议的吞吐量，因此我们需要一个高吞吐量的广播协议。

![](figure01.jpg "Zookeeper服务组件")

<div style="text-align: center;"><b>图1</b>：Zookeeper服务的逻辑组件。</div>

图1显示了ZooKeeper服务的逻辑构成。读取请求是由包含ZooKeeper状态的本地数据库提供服务。写入请求从ZooKeeper请求转化为empotent事务，并在生成响应之前通过Zab发送。许多ZooKeeper的写请求在本质上是有条件的：一个znode只有在没有任何子节点的情况下才能被删除；一个znode在创建时可以附加一个名字和一个序列号；对数据的改变只有在它处于预期的版本时才会被应用。即使是无条件的写请求，也会以不等价的方式修改元数据，如版本号。

通过将所有的更新通过一台服务器（被称为领导者）发送，我们将非同位素的请求转化为同位素的事务。在本文中，我们使用术语事务来表示请求的空当性版本。领导可以进行转换，因为它对复制的数据库的未来状态有一个完美的看法，可以计算出新记录的状态。idempotent事务是这个新状态的记录。ZooKeeper在很多方面都利用了同位素事务，这不在本文的讨论范围之内，但是我们的事务的同位素性质也允许我们在恢复期间放松我们的广播协议的排序要求

## 二、  要求

## 三、  为什么需要另一种协议